---
import { getCollection } from 'astro:content';

const archives = await getCollection('archives');

// Group by document type
const byType = archives.reduce((acc, doc) => {
  const type = doc.data.documentType;
  if (!acc[type]) acc[type] = [];
  acc[type].push(doc);
  return acc;
}, {} as Record<string, typeof archives>);

// Sort documents within each type by sortDate
Object.keys(byType).forEach(type => {
  byType[type].sort((a, b) => b.data.sortDate.valueOf() - a.data.sortDate.valueOf());
});

const types = Object.keys(byType).sort();
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Browse by Document Type - Bumi Bahru Archives</title>
    <style>
      body {
        font-family: Georgia, serif;
        max-width: 900px;
        margin: 0 auto;
        padding: 2rem;
        line-height: 1.6;
        background: #fafafa;
      }
      h1, h2 {
        border-bottom: 2px solid #333;
        padding-bottom: 0.5rem;
      }
      nav {
        margin: 2rem 0;
        padding: 1rem;
        background: #fff;
        border-left: 4px solid #333;
      }
      nav a {
        margin-right: 1.5rem;
        color: #333;
        text-decoration: none;
      }
      nav a:hover {
        text-decoration: underline;
      }
      .back-link {
        display: inline-block;
        margin: 1rem 0;
        color: #666;
        text-decoration: none;
      }
      .back-link:hover {
        color: #333;
      }
      .type-section {
        background: white;
        margin: 2rem 0;
        padding: 1.5rem;
        border-left: 4px solid #666;
      }
      .type-section h2 {
        margin-top: 0;
        color: #333;
        border: none;
        padding-bottom: 0;
      }
      .doc-count {
        color: #666;
        font-size: 0.9rem;
        font-weight: normal;
        margin-left: 0.5rem;
      }
      .document-list {
        list-style: none;
        padding: 0;
        margin-top: 1rem;
      }
      .document-item {
        padding: 1rem 0;
        border-bottom: 1px solid #eee;
      }
      .document-item:last-child {
        border-bottom: none;
      }
      .document-item h3 {
        margin: 0 0 0.5rem 0;
        font-size: 1.1rem;
      }
      .document-item a {
        color: #333;
        text-decoration: none;
      }
      .document-item a:hover {
        color: #000;
        text-decoration: underline;
      }
      .meta {
        color: #666;
        font-size: 0.9rem;
      }
    </style>
  </head>
  <body>
    <nav>
      <a href="/">Home</a>
      <a href="/archives">Archives</a>
      <a href="/blog">Blog</a>
    </nav>

    <a href="/archives" class="back-link">‚Üê Back to Archives</a>

    <h1>Browse by Document Type</h1>
    <p>Documents organized by format and communication type</p>

    {types.map((type) => (
      <div class="type-section">
        <h2>
          {type}
          <span class="doc-count">({byType[type].length} document{byType[type].length !== 1 ? 's' : ''})</span>
        </h2>
        <ul class="document-list">
          {byType[type].map((doc) => (
            <li class="document-item">
              <h3><a href={`/archives/${doc.slug}`}>{doc.data.title}</a></h3>
              <div class="meta">
                {doc.data.date} | {doc.data.department} | {doc.data.author}
              </div>
            </li>
          ))}
        </ul>
      </div>
    ))}
  </body>
</html>
